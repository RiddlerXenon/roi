<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Реализация поведенческого роевого алгоритма на основе модели Boids</title>
    
    <!-- Конфигурация MathJax ПЕРЕД загрузкой библиотеки -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                tags: 'ams',
                tagSide: 'right',
                processEscapes: true,
                processEnvironments: true
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                ready: () => {
                    console.log('MathJax готов к использованию');
                    MathJax.startup.defaultReady();
                    MathJax.startup.promise.then(() => {
                        showContent();
                    });
                }
            }
        };
    </script>
    
    <!-- Загрузка MathJax напрямую с CDN -->
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    
    <style>
        body {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: white;
            background-color: #111;
            font-family: 'Times New Roman', Times, serif;
        }
        
        .equation {
            margin: 20px 0;
            text-align: center;
            padding: 10px;
        }
        
        .references {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #333;
        }
        
        .references ol {
            padding-left: 0;
            list-style: none;
            counter-reset: ref-counter;
        }
        
        .references li {
            counter-increment: ref-counter;
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
            font-size: 14px;
        }
        
        .references li::before {
            content: counter(ref-counter) ".";
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        p {
            text-align: justify;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .math-inline {
            white-space: nowrap;
        }
        
        /* Стили для MathJax */
        .MathJax_Display {
            margin: 1em 0;
        }
        
        mjx-container {
            line-height: 0;
        }
        
        mjx-container[display="true"] {
            margin: 1em 0;
        }
        
        /* Загрузочный индикатор */
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 50px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #666;
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Индикатор загрузки -->
    <div id="loading" class="loading">
        <div class="loading-spinner"></div>
        Загрузка математических формул...
    </div>
    
    <!-- Основное содержимое (скрыто до загрузки MathJax) -->
    <div id="content" style="display: none;">
        <h1>Boids</h1>
        <p>Реализация поведенческого роевого алгоритма на основе модели Boids [1] в дискретном времени с полем восприятия [2], двумя схемами формирования соседства (метрической и топологической) [3], тремя базовыми поведенческими побуждениями (разделение, выравнивание, центрирование) [1, 2], опциональной линейной вязкостью среды и ограничением (с насыщением) норм ускорения и скорости [1, 4]. Состояние каждой особи $i=1,\dots,N$ на шаге $n\in\mathbb{N}$ задаётся парой $(x_i^n,v_i^n)\in\mathbb{R}^2\times\mathbb{R}^2$. Управляющее действие определяется как вектор «требуемого» ускорения $a_i^n$, после чего выполняется один шаг явного метода Эйлера с ограничением по нормам [4]. Параметры модели включают шаг интегрирования $\Delta t>0$, верхние оценки $\|v\|\le v_{\max}$ и $\|a\|\le a_{\max}$, целевую маршевую скорость $v_{\mathrm{pref}}\in(0,v_{\max}]$, временные константы релаксации $\tau_{\mathrm{match}},\tau_{\mathrm{center}},\tau_{\mathrm{sep}}>0$, неотрицательные коэффициенты для взвешенного суммирования правил $w_{\mathrm{match}},w_{\mathrm{center}},w_{\mathrm{sep}}\ge 0$, радиус восприятия $r>0$ (для метрического соседства) и зону отталкивания $r_{\mathrm{sep}}>0$, угол обзора $\phi\in(0,2\pi]$ [2], параметр топологического соседства $k\in\mathbb{N}$, а также коэффициент линейного вязкого сопротивления $\gamma\ge0$ [4].</p>

        <p>Введем эвристику отбора соседей. Для этого определим ориентированную область видимости особи $i$ как угловой сектор с вершиной в $x_i^n$, осью вдоль текущего направления $v_i^n$ и полууглом $\phi/2$ [2]. Формально, особь $j \ne i$ находится в поле восприятия $i$ на шаге $n$, если</p>

        <div class="equation">
            $$\langle v_i^n,\,x_j^n-x_i^n\rangle \ge \|v_i^n\|\,\|x_j^n-x_i^n\|\cos(\phi/2). \tag{1}$$
        </div>

        <p>При $\|v_i^n\|=0$ поле симуляруемого восприятия полагается изотропным. Множество возможных соседей ограничивается данным условием, после чего вводится одна из двух реализованных схем. Для метрической рассматриваются $j$ такие, что</p>

        <div class="equation">
            $$\|x_j^n-x_i^n\|\le r. \tag{2}$$
        </div>

        <p>В топологической осуществляется выбор $k$ ближайших по сферической (евклидовой) норме внутри сектора. Если их число меньше $k$, то подходящими полагаются все доступные [3]. Полученный результат в дальнейшем будем определять как окружение $\mathcal{N}_i^n$. Для правила разделения вводится отдельная изотропная ближняя зона</p>

        <div class="equation">
            $$\{ j \neq i: \| x_j^n-x_i^n \| < r_{\mathrm{sep}} \}, \tag{3}$$
        </div>

        <p>не связанная с сектором [1, 2]. С целью реализации ограничений $\|v\|\le v_{\max}$ и $\|a\|\le a_{\max}$, а также отсечения по норме при явном шаге интегрирования зададим оператор насыщения по норме</p>

        <div class="equation">
            $$\operatorname{sat}_M(u)=
            \begin{cases}
            u, & \|u\|\le M,\\
            u\dfrac{M}{\|u\|}\,, & \|u\|>M,
            \end{cases}
            \qquad M\ge 0,\ \ u\in\mathbb{R}^d; \tag{4}$$
        </div>

        <p>и оператор установки нормы</p>

        <div class="equation">
            $$\operatorname{setmag}(u,m)=
            \begin{cases}
            u\dfrac{m}{\|u\|}\,, & \|u\|>0,\\
            0, & \|u\|=0,
            \end{cases}
            \qquad m\ge 0,\ \ u\in\mathbb{R}^d. \tag{5}$$
        </div>

        <p>Закон управления состоит из суммы трех поведенческих побуждений, соответствующих правилам разделения, выравнивания и центрирования [1, 2, 4, 5]. <em>Компонента выравнивания</em> согласует скорость особи с локальным средним по ее окружению. При $|\mathcal N_i^n|>0$ локальное среднее скорости соседей задается как</p>

        <div class="equation">
            $$\bar v_i^n=\frac{1}{|\mathcal N_i^n|}\sum_{j\in\mathcal N_i^n} v_j^n, \tag{6}$$
        </div>

        <p>после чего формируется опорный вектор скорости выравнивания</p>

        <div class="equation">
            $$r_i^{\mathrm{match}}=
            \begin{cases}
            \mathrm{setmag}\!\bigl(\bar v_i^n,\min\{v_{\mathrm{pref}},v_{\max}\}\bigr), & \|\bar v_i^n\|\ge\varepsilon,\\
            v_i^n, & \|\bar v_i^n\|< \varepsilon.
            \end{cases} \tag{7}$$
        </div>

        <p>Ускорение выравнивания записывается уравнением релаксации первого порядка</p>

        <div class="equation">
            $$a_i^{\mathrm{match}}=\dfrac{r_i^{\mathrm{match}}-v_i^n}{\max\{\tau_{\mathrm{match}}, \varepsilon\}}. \tag{8}$$
        </div>

        <p>Если $|\mathcal N_i^n|=0$, то $a_i^{\mathrm{match}}=0$. Формально, это позволяет при исчезающе малом локальном среднем скорости не навязывать системе искусственное «стягивание» к нулю и исключить неопределенность направления оператора $\mathrm{setmag}(0,\cdot)$. В приводимой авторами реализации $\varepsilon=10^{-6}$. <em>Компонента центрирования</em> направляет особь к локальному центру соседей. При $|\mathcal N_i^n|>0$ положим</p>

        <div class="equation">
            $$c_i^n=\frac{1}{|\mathcal N_i^n|}\sum_{j\in\mathcal N_i^n} x_j^n,\qquad \bar c_i^n=c_i^n-x_i^n. \tag{9}$$
        </div>

        <p>Опорный вектор скорости центрирования определим как</p>

        <div class="equation">
            $$r_i^{\mathrm{center}}=\mathrm{setmag}\!\bigl(\bar c_i^n,\min\{v_{\mathrm{pref}},v_{\max}\}\bigr). \tag{10}$$
        </div>

        <p>Ускорение центрирования задается уравнением релаксации, аналогичным уравнению (8)</p>

        <div class="equation">
            $$a_i^{\mathrm{center}}=
            \begin{cases}
            \dfrac{r_i^{\mathrm{center}}-v_i^n}{\max\{\tau_{\mathrm{center}},\varepsilon\}}, & |\mathcal N_i^n|>0\ \wedge \| \bar c_i^n\|\ge \varepsilon.\\
            0.
            \end{cases} \tag{11}$$
        </div>

        <p><em>Компонента разделения</em> реализует локализованное отталкивание в изотропной ближней зоне и не зависит от введенной ранее эвристики отбора соседей $\mathcal N_i^n$. Обозначив относительный радиус-вектор $d_{ij}^n=x_j^n-x_i^n$, направленный от особи $i$ к особи $j$, находим суммарную отталкивающую «социальную» силу, действующую на особь $i$ на шаге $n$ как</p>

        <div class="equation">
            $$F_i^n=\sum_{\substack{j\ne i\\[3pt] 0<\|d_{ij}^n\| < r_{\mathrm{sep}}}}
            \max\!\left\{0,\frac{r_{\mathrm{sep}}}{\|d_{ij}^n\|}-1\right\}\!\left(-\frac{d_{ij}^n}{\|d_{ij}^n\|}\right), \tag{12}$$
        </div>

        <p>где каждый компонент суммирования направлен от $j$ к $i$ и имеет неотрицательный вес, убывающий монотонно по расстоянию и обнуляющийся при $\|d_{ij}^n \| \ge r_{\mathrm{sep}}$. Тогда вклад разделения определяется как</p>

        <div class="equation">
            $$a_i^{\mathrm{sep}}=\frac{k_{\mathrm{sep}}}{\max\{\tau_{\mathrm{sep}},\varepsilon\}}\,F_i^n, \tag{13}$$
        </div>

        <p>а при отсутствии ближайших соседей $\left( \forall j : \| d_{ij}^n \| \ge r_{\mathrm{sep}} \right)$ полагается $a_i^{\mathrm{sep}}=0$ [1, 2]. Это равносильно движению вниз по градиенту радиально возрастающего отталкивающего потенциала и согласуется с подходом «социальных сил» для предотвращения столкновений. Опционально вводится компонента вязкого сопротивления среды. При ее включении вклад в управляемое ускорение особи $i$ на шаге $n$ задается как</p>

        <div class="equation">
            $$a_i^{\mathrm{damp}}=-\gamma\,v_i^n,\quad \gamma \ge 0, \tag{14}$$
        </div>

        <p>при $\gamma = 0$ полагаем $a_i^{\mathrm{damp}} = 0$. Коэффициент линейного сопротивления $\gamma$ задает экспоненциальную скорость затухания свободного движения для непрерывной модели</p>

        <div class="equation">
            $$\dot{v} =- \gamma v, \tag{15}$$
        </div>

        <p>откуда решение имеет вид</p>

        <div class="equation">
            $$v(t) = v(0) e^{-\gamma t}. \tag{16}$$
        </div>

        <p>Конечная суперпозиция побуждений и насыщение в приводимой авторами реализации формализуется следующим образом. «Запрашиваемое» управляемое ускорение формируется как сумма всех поведенческих вкладов $a_i^{\mathrm{match}}$, $a_i^{\mathrm{center}}$ и $a_i^{\mathrm{sep}}$ с опциональным компонентом вязкого сопротивления среды $a_i^{\mathrm{damp}}$, принимая вид</p>

        <div class="equation">
            $$a_{i, \mathrm{req}}^n=
            w_{\mathrm{sep}}\,a_i^{\mathrm{sep}}+
            w_{\mathrm{match}}\,a_i^{\mathrm{match}}+
            w_{\mathrm{center}}\,a_i^{\mathrm{center}}+
            a_i^{\mathrm{damp}}, \tag{17}$$
        </div>

        <p>где $w_{\mathrm{sep}}, w_{\mathrm{match}}, w_{\mathrm{center}} \ge 0$ являются параметрами, определяющими коэффициент линейного масштабирования соответсвующего поведенческого правила [1, 4]. К полученному значению применяется насыщение по норме</p>

        <div class="equation">
            $$a_i^n = \operatorname{sat}_{a_{\max}} \left( a_{i, \mathrm{req}}^n \right). \tag{18}$$
        </div>

        <p>Данное ускорение будем определять как фактическое, удовлетворяющее требованию $\| a_i^n \| \le a_{\max}$ для всех $n$. После реализуется дискретная кинематика на основе явной схемы Эйлера с отсечкой скорости:</p>

        <div class="equation">
            $$v_i^{n+1} = \operatorname{sat}_{v_{\max}} \left( v_i^n +a_i^n \Delta t \right), \tag{19}$$
        </div>

        <div class="equation">
            $$x_i^{n+1} = x_i^n + v_i^{n+1} \Delta t, \tag{20}$$
        </div>

        <p>где $\Delta t >0 \wedge \| v_i^{n+1} \| \le v_{\max}$ [4].</p>

        <p>В прямоугольной области визуализации $[0, W] \times [0, H]$ заданы отражающие граничные условия. При выходе за область соответствующая координата положения ортогонально проецируется на границу, то есть проводится замена на $0$ или $W$ для $x$ и на $0$ или $H$ для $y$, а соответствующая компонента скорости меняет свой знак. Это реализует зеркальное отражение и не нарушает ограничение $\|v_i^{n+1}\|\le v_{\max}$ [1, 4]. Формально, секторная фильтрация по углу $\phi$ вводит механизм моделирования восприятия агентов. Метрическое соседство $\{j:\|x_j^n-x_i^n\|\le r\}$ соответствует классической постановке Boids и инженерным процедурам стаивания [1]. Топологическое соседство фиксированного размера согласуется с эмпирикой по стаям скворцов, где число эффективно взаимодействующих ближайших соседей составляет порядка 6 - 7 и не зависит от плотности [3]. Отдельная ближняя зона $r_{\mathrm{sep}}$ обеспечивает локальную динамику отталкивания, в то время как выравнивание и центрирование формируют согласованную динамику роя [1, 2]. На феноменологическом уровне различные вариации параметров $(\Delta t,v_{\max},a_{\max},v_{\mathrm{pref}},\tau_{\cdot},w_{\cdot},r,r_{\mathrm{sep}},\phi,k,\gamma)$ воспроизводят известные переходы «беспорядок / когерентное движение», качественно схожие с поведением в модели Вичека, а также в смежных агентных системах [2, 3, 5], но строгая теоретическая эквивалентность авторами не доказывается.</p>

        <p>Выбор окружения в метрическом режиме требует фильтрации по сектору и порогу расстояния, в топологическом — дополнительной сортировки кандидатов по евклидову расстоянию; в наивной реализации суммарная сложность шага по времени составляет $O(N^2)$ для метрического режима и $O(N^2 \log{N})$ для топологического, что является допустимым для интерактивной визуализации.</p>

        <div class="references">
            <ol>
                <li>Reynolds, Craig. (1987). Flocks, Herds, and Schools: A Distributed Behavioral Model. ACM SIGGRAPH Computer Graphics. 21. 25-34. 10.1145/280811.281008.</li>
                
                <li>Couzin F.R.S., Iain & Krause, Jens & James, Richard & Ruxton, Graeme & Franks, Nigel. (2002). Collective Memory and Spatial Sorting in Animal Groups. Journal of theoretical biology. 218. 1-11. 10.1006/jtbi.2002.3065.</li>
                
                <li>Ballerini, M & Cabibbo, N & Candelier, Raphaël & Cavagna, A & Cisbani, Evaristo & Giardina, Irene & Lecomte, V & Orlandi, A & Parisi, G & Procaccini, A & Viale, Massimiliano & Zdravkovic, Vladimir. (2008). Interaction Ruling Animal Collective Behaviour Depends on Topological rather than Metric Distance: Evidence from a Field Study. Proceedings of the National Academy of Sciences of the United States of America. 105. 1232-7. 10.1073/pnas.0711437105.</li>
                
                <li>(2006). Flocking for Multi-Agent Dynamic Systems: Algorithms and Theory. Automatic Control, IEEE Transactions on. 51. 401 - 420. 10.1109/TAC.2005.864190.</li>
                
                <li>Vicsek T, Czirók A, Ben-Jacob E, Cohen I I, Shochet O. Novel type of phase transition in a system of self-driven particles. Phys Rev Lett. 1995 Aug 7;75(6):1226-1229. doi. 10.1103/PhysRevLett.75.1226. PMID: 10060237.</li>
            </ol>
        </div>
    </div>

    <script>
        function showContent() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            console.log('Контент отображен');
        }

        // Функция для проверки и ожидания загрузки MathJax
        function waitForMathJax() {
            if (window.MathJax && window.MathJax.startup && window.MathJax.startup.promise) {
                window.MathJax.startup.promise.then(() => {
                    console.log('MathJax полностью загружен и готов');
                    // Дополнительно рендерим все формулы
                    if (window.MathJax.typesetPromise) {
                        window.MathJax.typesetPromise([document.getElementById('content')])
                            .then(() => {
                                console.log('Все математические формулы отрендерены');
                            })
                            .catch((err) => {
                                console.log('Ошибка рендеринга формул:', err);
                            });
                    }
                }).catch((err) => {
                    console.log('Ошибка загрузки MathJax:', err);
                    showContent(); // Показываем контент даже при ошибке
                });
            } else {
                // Если MathJax не загружается, ждем и повторяем
                setTimeout(waitForMathJax, 100);
            }
        }

        // Ждем загрузки DOM
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM загружен');
            
            // Устанавливаем таймаут как fallback
            setTimeout(() => {
                if (document.getElementById('loading').style.display !== 'none') {
                    console.log('Показываем контент по таймауту');
                    showContent();
                }
            }, 5000); // 5 секунд максимум ожидания
            
            // Начинаем ожидание MathJax
            waitForMathJax();
        });

        // Также слушаем событие полной загрузки страницы
        window.addEventListener('load', function() {
            console.log('Страница полностью загружена');
            // Дополнительная проверка через секунду
            setTimeout(() => {
                if (document.getElementById('loading').style.display !== 'none') {
                    console.log('Показываем контент после загрузки страницы');
                    showContent();
                }
            }, 1000);
        });
    </script>
</body>
</html>
