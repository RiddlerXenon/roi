<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>ROI - Исследование алгоритмов оптимизации</title>
  <link rel="stylesheet" href="../static/css/styles.css">
  <!-- Simple math styling -->
  <style>
    .math-block {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
      font-family: 'Courier New', monospace;
      color: #e0e0e0;
      text-align: center;
    }
    .math-inline {
      background: #333;
      padding: 2px 4px;
      border-radius: 2px;
      font-family: 'Courier New', monospace;
      color: #e0e0e0;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="main-header">
    <h1>Исследование алгоритмов оптимизации и интеллектуальных систем</h1>
    <p class="subtitle">Интерактивные демонстрации и визуализации</p>
  </header>

  <!-- Main content -->
  <main class="main-content">
    <!-- Algorithm tiles grid -->
    <section class="tiles-grid">
      <!-- Tile 1: Boids -->
      <div class="tile" onclick="openModal('./boids.html')">
        <div class="tile-preview">
          <canvas id="previewBoids"></canvas>
        </div>
        <div class="tile-title">Boids Simulation</div>
        <div class="tile-subtitle">Модель стайного поведения</div>
      </div>

      <!-- Tile 2: Ant Colony -->
      <div class="tile" onclick="openModal('./ants.html')">
        <div class="tile-preview">
          <canvas id="previewAnts"></canvas>
        </div>
        <div class="tile-title">Ant Colony Optimization</div>
        <div class="tile-subtitle">Муравьиный алгоритм</div>
      </div>

      <!-- Tile 3: SDS -->
      <div class="tile" onclick="openModal('./sds.html')">
        <div class="tile-preview">
          <canvas id="previewSDS"></canvas>
        </div>
        <div class="tile-title">Stochastic Diffusion Search</div>
        <div class="tile-subtitle">Стохастический поиск</div>
      </div>

      <!-- Tile 4: Enhanced Boids -->
      <div class="tile" onclick="openModal('./boids_alt.html')">
        <div class="tile-preview">
          <canvas id="previewBoidsAlt"></canvas>
        </div>
        <div class="tile-title">Enhanced Boids</div>
        <div class="tile-subtitle">Расширенная модель стай</div>
      </div>
    </section>

    <!-- Site description -->
    <section class="site-description">
      <h2>О проекте</h2>
      <p>
        Данный веб-ресурс представляет собой интерактивную платформу для изучения и демонстрации 
        различных алгоритмов оптимизации и методов искусственного интеллекта. Каждый алгоритм 
        реализован с возможностью интерактивного управления параметрами и визуализации процесса работы в реальном времени.
      </p>
      <p>
        Проект создан для образовательных целей и исследований в области вычислительного интеллекта, 
        предоставляя наглядное представление о принципах работы биоинспирированных алгоритмов и методов роевого интеллекта.
      </p>
    </section>
  </main>

  <!-- Footer -->
  <footer class="main-footer">
    <div class="footer-content">
      <div class="footer-info">
        <p>Разработано в <strong>Курском Государственном Университете</strong></p>
        <p>Кафедра прикладной математики и компьютерных технологий</p>
      </div>
      <div class="footer-links">
        <a href="https://github.com/RiddlerXenon/roi" target="_blank" class="github-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
          </svg>
          GitHub Repository
        </a>
      </div>
    </div>
  </footer>

  <div class="overlay" id="overlay">
    <div class="modal">
      <button class="close-btn" onclick="closeModal()">✕</button>
      <iframe id="modalFrame" src=""></iframe>
    </div>
  </div>

  <script>
    function openModal(page) {
      const overlay = document.getElementById("overlay");
      const frame = document.getElementById("modalFrame");

      overlay.classList.add("active");

      frame.onload = () => {
        const w = frame.contentWindow;
        if (!w) return;

        // Pause all previews when opening modal
        pauseAllPreviews();

        // For specific pages that need initialization
        if (page.includes("ants.html") && typeof w.newGraph === "function") {
          w.newGraph();
        }
      };

      frame.src = page;
    }

    function closeModal() {
      document.getElementById("modalFrame").src = "";
      document.getElementById("overlay").classList.remove("active");
      
      // Resume previews when closing modal
      resumeAllPreviews();
    }

    // Global preview control functions
    let previewInstances = {};

    function pauseAllPreviews() {
      Object.values(previewInstances).forEach(instance => {
        if (instance && instance.pauseAnimation) {
          instance.pauseAnimation();
        }
      });
    }

    function resumeAllPreviews() {
      Object.values(previewInstances).forEach(instance => {
        if (instance && instance.startAnimation) {
          instance.startAnimation();
        }
      });
    }
  </script>

  <script type="module">
    import { initBoids } from "../static/js/boids.js";
    import { initAnts } from "../static/js/ants.js";
    import { initSDS } from "../static/js/sds.js";

    // Wait for DOM to load
    document.addEventListener('DOMContentLoaded', () => {
      // Preview for boids
      const previewBoids = document.getElementById("previewBoids");
      if (previewBoids) {
        previewInstances.boids = initBoids(previewBoids, { 
          boidCount: 20, 
          boidSize: 3, 
          separationWeight: 3, 
          separationDist: 70, 
          maxSpeed: 6, 
          fov: 360,
          isPreview: true,
          autoStart: true
        });
      }

      // Preview for ants
      const previewAnts = document.getElementById("previewAnts");
      if (previewAnts) {
        previewInstances.ants = initAnts(previewAnts, { 
          nodeCount: 8, 
          alpha: 1.0, 
          beta: 2.0, 
          rho: 0.3, 
          autoRun: true
        });
      }

      // Preview for SDS
      const previewSDS = document.getElementById("previewSDS");
      if (previewSDS) {
        previewInstances.sds = initSDS(previewSDS, { 
          N: 30, 
          func: 'twopeaks', 
          showHeatmap: true, 
          showTraj: false, 
          showBest: true,
          heatGrid: 16,
          autoStart: true
        });
      }

      // Preview for enhanced boids (will need to create boids_alt.html)
      const previewBoidsAlt = document.getElementById("previewBoidsAlt");
      if (previewBoidsAlt) {
        // For now, use regular boids with different parameters
        previewInstances.boidsAlt = initBoids(previewBoidsAlt, { 
          boidCount: 30, 
          boidSize: 2, 
          separationWeight: 2, 
          separationDist: 50, 
          maxSpeed: 4, 
          fov: 180,
          isPreview: true,
          autoStart: true
        });
      }

      // Initialize KaTeX auto-render when available
      if (typeof renderMathInElement !== 'undefined') {
        renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false}
          ]
        });
      }
    });
  </script>
  </script>
</body>
</html>
